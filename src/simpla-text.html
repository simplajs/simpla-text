<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../simpla-element-behavior/simpla-element-behavior.html">

<dom-module id="simpla-text">
  <template>
    <style>
      :host {
        display: block;
      }

      :host([contenteditable]) {
        outline: none;
      }

      :host([inline]) {
        display: inline;
      }
    </style>
    <slot></slot>
  </template>
  <script>
    import editor from './behaviors/editor-connector';
    import inline from './behaviors/inline';

    const SIMPLA_CONFIG = {
      type: 'Text',
      dataProperties: [ 'value' ],
      updateOn: [ 'input' ]
    };

    class SimplaText {
      beforeRegister() {
        this.is = 'simpla-text';

        this.properties = {

          plaintext: {
            type: Boolean,
            value: false
          },

          placeholder: {
            type: String,
            value: 'Enter your text...'
          },

          editable: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true
          },

          active: {
            type: Boolean,
            notify: true,
            readOnly: true,
            value: false
          }
        };

        this.listeners = {
          'tap': '_handleTap',
          'blur': '_handleBlur',
          'focus': '_handleFocus'
        };
      }

      get behaviors() {
        return [ SimplaBehaviors.Element(SIMPLA_CONFIG), editor, inline ];
      }

      _handleBlur() {
        this._setActive(false);
      }

      _handleFocus() {
        if (this.editable) {
          this._setActive(true);
        }
      }

      _handleTap() {
        if (this.editable) {
          this._setActive(true);
        }
      }

      _editableObserver(editable) {
        if (!editable) {
          this._setActive(false);
        }
      }

      get value() {
        let editor = this.getEditor();
        return editor ? editor.getHTML() : this.innerHTML;
      }

      set value(value) {
        let editor = this.getEditor();

        if (editor) {
          editor.setHTML(value);
        } else {
          this.innerHTML = value;
        }
      }
    };

    Polymer(SimplaText)
  </script>
</dom-module>
